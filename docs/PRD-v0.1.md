# PRD v0.1 — Opencode Dev Bootstrap（暂定名）

## 1. 项目概述

### 1.1 一句话定义
为新电脑 / 新环境的开发者提供一个 **“一条命令就能完成开发环境开荒”** 的工具，  
底层由 **Opencode AI + 开荒 Skills 工作流** 驱动，支持 Windows / macOS，以及在 Docker / 租用机上复用同一套流程。

### 1.2 核心价值
- 把一个“经验严重依赖个人、难以复现”的**环境初始化过程**  
  → 变成一个 **可脚本化、可观察、可复用的自动化流程**。
- 通过 **AI + 预设最佳实践 Skills**，让开发者不必再到处搜教程、复制命令，而是：
  - 用一条命令 + 少量交互
  - 获得一套 **符合主流最佳实践** 的开发环境。

## 2. 目标用户 & 使用场景

### 2.1 阶段一（当前阶段）目标用户：开发者
特征：
- 能看懂英文 README
- 有过至少 1 次给新电脑 / 新虚拟机配开发环境的经历
- 用过 git / GitHub / 包管理工具（brew / winget 等）

典型 Persona：
1. **频繁换机 / 租云机的个人开发者**
2. **远程实习 / 入职前，需要配置公司要求环境的新人**
3. **需要快速拉起“干净环境”做实验的工程师**

### 2.2 未来阶段（不在 MVP 范围）的用户：小白
- 希望“点两下 / 执行一条命令就能开始写代码”
- 不关心什么是 brew / ssh key / git config
- 对故障排查能力弱

> 当前阶段对小白：  
> 不主动宣传，只在设计上 **保留未来扩展空间**（例如命令行问题更自然、错误提示更友好）。

## 3. 需求背景 & 问题拆解

### 3.1 当前世界的典型路径
- 搜索 “mac 开发环境搭建 2025”
- 打开几篇博客 / B 站视频
- 手动：
  - 安装包管理器（brew / winget / choco）
  - 安装 git / node / python / 编辑器
  - 配置 ssh / git 用户名 / 邮箱
  - 配 zsh / oh-my-zsh / 代理 / 字体 等

问题：
- 教程版本老旧、断链、不同作者风格冲突
- 配置不可复用：每次新机器都要重复一轮
- 不容易发现“漏装了什么”或“环境不一致导致 bug”
- 经验很难分享给别人 / 新成员

### 3.2 本项目要解决的核心问题

1. **初始化知识分散 & 不可复现**
2. **每个人都在“重复造轮子”**
3. **环境状态不可观测，出了问题很难回溯**

## 4. 产品目标 & 非目标（MVP）

### 4.1 MVP 目标（v0.1）

**平台：**
- macOS（Apple Silicon / Intel）
- Windows 10+（优先使用官方工具链，如 winget / powershell）

**能力：**
1. 提供一条安装命令：
   - macOS: `curl ... | sh`
   - Windows: `powershell -Command "..."`

2. 自动完成以下内容（开发环境最小集合）：
   - 检测 OS / 架构 / 基本信息
   - 安装并检查：
     - git
     - 包管理器（brew / winget，如已有则跳过）
     - Node.js（通过 nvm / nvm-windows 或等价工具）
     - Python（保留版本可配空间，但 MVP 只做 1 个默认版本）
   - 初始化 ssh 环境：
     - 若无 ssh key：引导生成 + 可选上传到 GitHub/GitLab（MVP 可以仅生成）
   - git 基本配置：
     - user.name / user.email
     - 默认分支名称（main）
     - 简单别名（可选）

3. 提供**基础交互体验**：
   - 简单问答式 CLI：
     - “你主要是做什么开发？”
       - [1] Web / Node
       - [2] Python / AI
       - [3] 通用开发环境
   - 根据选择加载不同的 “开荒 Skill 组合”。

4. 与 Opencode 的基本集成：
   - 本地脚本作为 **客户端 & 命令执行器**
   - Opencode 承担：
     - 解读当前系统信息
     - 选择 & 组合对应 Skills
     - 生成需要执行的命令 / 步骤
   - 本地客户端负责：
     - 执行命令
     - 收集并回传日志（可在后续版本可视化）

### 4.2 非目标（MVP 不做）
- 不做：
  - 完整 Dotfiles 管理
  - Nix / 完全声明式系统管理
  - 深度 GUI 软件安装 & 配置（IDE / 浏览器等）
  - 自动处理所有云厂商实例差异
  - 用户账号体系 / 云同步
  - Web UI / 桌面客户端
- 安全边界：
  - 不自动处理敏感信息（云密钥、生产环境 credentials）
  - 不自动上传 ssh key / token（仅在终端提示如何操作）

## 5. 关键体验流程（MVP）

### 5.1 安装与首次运行流程（示意）

以 macOS 为例：

1. 用户在终端执行：

   ```bash
   /bin/bash -c "$(curl -fsSL https://opencode.dev/bootstrap.sh)"
   ```

2. bootstrap.sh 完成：
   - 检测系统信息
   - 下载项目 CLI 二进制或脚本
   - 校验完整性（hash / 签名，后续版本）

3. CLI 启动，展示：

   - 欢迎信息
   - 简短风险提示（“将在本地执行安装命令，请确认你信任本项目”）
   - 问答：
     - 选择开发类型
     - 是否已有 ssh key
     - 是否已有包管理器（自动检测 + 用户确认）

4. CLI 将：
   - 打包当前状态（OS, arch, 已有工具版本等）为上下文
   - 调用 Opencode API，触发对应开荒 Skill 工作流

5. Opencode：
   - 根据上下文 + 预设 Skill 模板，生成一个 “步骤列表 / 命令计划”
   - 返回给 CLI

6. CLI：
   - 按步骤执行命令
   - 流式输出日志
   - 对重要操作进行二次确认（如已有版本冲突卸载）

7. 结束后输出：
   - 简短总结（安装了什么）
   - “下次如何在新机器上复用当前方案”的提示（后续版本可生成配置文件）

## 6. 技术架构概览（v0.1）

### 6.1 关键组件

1. **Bootstrap Installer（shell / powershell）**
   - 负责拉起 CLI
   - 尽量保持极简、可审查

2. **CLI 客户端**
   - 语言：Go / Rust / Python（待定，MVP 可先用 Python 方便开发）
   - 功能：
     - 探测系统信息
     - 与 Opencode HTTP API 通信
     - 执行从 Skills 生成的命令
     - 处理错误 & 回滚（至少提示）

3. **Opencode 后端 & Skills**
   - 使用 Opencode 的现有 API 能力
   - 定义一组 “开荒 Skills”，例如：
     - `setup_package_manager`
     - `setup_git`
     - `setup_ssh`
     - `setup_node_env`
     - `setup_python_env`
   - 每个 Skill 描述：
     - 适用平台 / 前置条件
     - 需要的用户输入
     - 生成的命令序列

## 7. 里程碑规划

### Milestone 0 — 内部验证版
- 平台：仅 macOS
- CLI：Python 脚本即可
- 功能：
  - `setup_package_manager` + `setup_git` + `setup_node_env`
- 运行方式：
  - 在本地 / Docker 内测试

### Milestone 1 — 开源可用版
- 支持 macOS + Windows
- 补齐 Python 环境开荒
- 完成基础 README + 使用文档
- 提供若干简单示例：
  - “10 分钟搭建一个 Web 开发环境”

### Milestone 2 — 可扩展 & 社区贡献版
- 完善 Skill 规范文档（为贡献者写）
- 增加测试方案（在 Docker / CI 中跑开荒）
- 考虑导出/导入“我的开荒方案”配置
